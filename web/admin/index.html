<?php

// authorization handler
require __DIR__ . '/../lib/consts.php';
require __DIR__ . '/../lib/AuthCookie.php';

?>
<!DOCTYPE html>
<html>
<head>
	<title></title>
	<style type="text/css">
		p {
			font-family: Arial, Geneva, Helvetica, sans-serif;
			font-size: 18pt;
			text-align: center;
		}
		body {
		    margin:50px 0px; padding:0px;
		    text-align: center;
		    align:center;
		}
		form {
    		display: inline-block;
		}
		label, input {
		 display: block;
		 width: 150px;
		 float: left;
		 margin-bottom: 10px;
		}

		label {
		 width: 75px;
		 padding-right: 20px;
		}

		br {
		 clear: left;
		}

		#adminPage, #loginForm {
			display: none;
		}
		

	</style>
</head>
<body>
	<p>
	thediscoverables.com html Administration
	</p>
	<div id='adminPage' 
		data-bind="style: { display: administrator.isAuthenticated() ? 'block' : 'hidden' }">
		<button name="submit" id="logout" class="button">logout</button>
		<div id="userInfo" data-bind="with: administrator">
			<div>Email is <span data-bind="text: email"></span></div>
			<div>
				The name is <span data-bind="text: firstName"></span>
				<span data-bind="text: lastName"></span>
			</div>
			<div>Username is <span data-bind="text:username"></span></div>
		</div>
		<div id='songsAdmin' class="adminSection">
			Admin for Songs
		</div>
		<div id='playlistsAdmin' class="adminSection">
			Admin for Playlists
		</div>
		<div id='albumsAdmin' class="adminSection">
			Admin for Album
		</div>
	</div>
	<div id='loginForm'
		data-bind="style: { display: administrator.isAuthenticated() ? 'hidden' : 'block' }">
		<form method="javascript:void(0)" action="login.php">
			<label for="username">Username</label>
			<input id="username" name="username"><br>

			<label for="password">Password</label>
			<input id="password" name="password"><br>

			<input type="submit" name="submit" id="submit" value="submit" class="button" />
		</form>
	</div>
</body>
<script type='text/javascript' src='https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js'></script>
<script type='text/javascript' src='https://cdnjs.cloudflare.com/ajax/libs/knockout/3.5.0/knockout-min.js'></script>
<script type='text/javascript' src='../script/view_modles/user.js'></script>
<script>

	var administrator = new User();
	$(function() {
		$.getJSON("/lib/handlers/authorize.php", function(data) {
			var data = JSON.parse(data.responseText);
			administrator.id('123')
			 .username('adam')
			 .firstName('Adam')
			 .lastName('Cohen')
			 .email('thediscoverables@gmail.com')
			 .statusId(1);
		})
		.fail(function(data, textStatus, errorThrown) {
			console.log('getJSON request failed! ' + textStatus);
	    }).always(function(data) {
			var data = JSON.parse(data.responseText);
			runLanding(administrator);
		});
	    console.log('AuthCookie::isValid() = ' + <?php echo AuthCookie::isValid() ?>)
		var runLanding = function(administrator) {
		// 	administrator.id('123')
		// 	 .username('adam')
		// 	 .firstName('Adam')
		// 	 .lastName('Cohen')
		// 	 .email('thediscoverables@gmail.com')
		// 	 .statusId(1)
		// 	 .isAuthenticated(true);
			var adminPageViewModel = {
				administrator: administrator
			};
			ko.applyBindings(adminPageViewModel);
		}

	});

</script>
</html>



